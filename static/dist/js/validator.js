(()=>{var g=class{constructor(e){this.form=e,this.messages={required:e.dataset.msgRequired||"Required",minLength:e.dataset.msgMinLength||"Too short",passwordMatch:e.dataset.msgPasswordMatch||"Does not match",passwordWeak:e.dataset.msgPasswordWeak||"Too weak",email:e.dataset.msgEmail||"Invalid email",phone:e.dataset.msgPhone||"Invalid phone",noDigits:e.dataset.msgNoDigits||"Numbers not allowed"}}validate(){let e=!0;return this.form.querySelectorAll("[data-validate]").forEach(t=>{let s=this.validateInput(t);s?(this.showError(t,s),e=!1):this.clearError(t)}),e}validateInput(e){let t=e.value.trim(),s=e.dataset.validate.split("|");for(let n of s){let[a,o]=n.split(":");if(a==="required"&&!t)return this.messages.required;if(a==="min"&&t.length<parseInt(o))return this.messages.minLength;if(a==="password"&&(!/\d/.test(t)||!/[!@#$%^&*(),.?":{}|<>_\-]/.test(t)))return this.messages.passwordWeak;if(a==="match"){let i=document.getElementById(o);if(i&&t!==i.value)return this.messages.passwordMatch}if(a==="email"&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t))return this.messages.email;if(a==="phone"&&!/^\+\d{7,15}$/.test(t.replace(/\s/g,"")))return this.messages.phone;if(a==="nodigits"&&/\d/.test(t))return this.messages.noDigits}return null}showError(e,t){let n=e.closest(".flex.flex-col.gap-2")?.querySelector(".input-error");e.closest(".input-floating")?.classList.add("error"),n&&(n.textContent=t,n.classList.remove("hidden"))}clearError(e){let s=e.closest(".flex.flex-col.gap-2")?.querySelector(".input-error");e.closest(".input-floating")?.classList.remove("error"),s&&(s.textContent="",s.classList.add("hidden"))}},d={COOLDOWN_MS:3*60*1e3,getKey(r){return`resend_cooldown_${r}`},setCooldown(r){let e=Date.now()+this.COOLDOWN_MS;localStorage.setItem(this.getKey(r),e.toString())},getRemainingTime(r){let e=localStorage.getItem(this.getKey(r));if(!e)return 0;let t=parseInt(e)-Date.now();return t>0?t:0},isOnCooldown(r){return this.getRemainingTime(r)>0},formatTime(r){let e=Math.floor(r/6e4),t=Math.floor(r%6e4/1e3);return`${e}:${t.toString().padStart(2,"0")}`}},m=null;function u(r){let e=document.getElementById("resend-email");if(!e)return;m&&clearInterval(m);function t(){let s=d.getRemainingTime(r);s>0?(e.disabled=!0,e.textContent=`Resend in ${d.formatTime(s)}`):(e.disabled=!1,e.textContent="Didn't receive? Resend",clearInterval(m))}t(),m=setInterval(t,1e3)}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("form[data-msg-required]").forEach(e=>{let t=new g(e);e.addEventListener("submit",async s=>{if(s.preventDefault(),!!t.validate()){if(e.id==="forgot-password-form"){let a=e.querySelector('input[type="email"]').value.trim(),o=e.querySelector('button[type="submit"]'),i=o.querySelector(".btn-text"),c=o.querySelector(".btn-loader"),l=e.querySelector(".input-error");i&&i.classList.add("hidden"),c&&c.classList.remove("hidden"),o.disabled=!0;try{let f=await(await fetch(e.dataset.action,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e.querySelector('[name="csrfmiddlewaretoken"]')?.value||getCookie("csrftoken")},body:JSON.stringify({email:a})})).json();f.success?(d.setCooldown(a),document.getElementById("sent-email").textContent=a,document.getElementById("modal-forgot-password")?.classList.remove("active"),document.getElementById("modal-check-email")?.classList.add("active"),u(a),e.reset()):l&&(l.textContent=f.error||"Something went wrong",l.classList.remove("hidden"))}catch(h){console.error("Error:",h),l&&(l.textContent="Network error. Please try again.",l.classList.remove("hidden"))}finally{i&&i.classList.remove("hidden"),c&&c.classList.add("hidden"),o.disabled=!1}return}e.submit()}}),e.querySelectorAll("[data-validate]").forEach(s=>{s.addEventListener("blur",()=>{let n=t.validateInput(s);n?t.showError(s,n):t.clearError(s)}),s.addEventListener("input",()=>t.clearError(s))})}),document.getElementById("resend-email")?.addEventListener("click",async e=>{let t=e.target,s=document.getElementById("sent-email")?.textContent;if(!(!s||d.isOnCooldown(s))){t.disabled=!0,t.textContent="Sending...";try{await new Promise(n=>setTimeout(n,1e3)),d.setCooldown(s),t.textContent="Email sent!",setTimeout(()=>u(s),1500)}catch{t.textContent="Error. Try again",t.disabled=!1}}});let r=document.getElementById("modal-check-email");r&&new MutationObserver(t=>{t.forEach(s=>{if(s.target.classList.contains("active")){let n=document.getElementById("sent-email")?.textContent;n&&u(n)}})}).observe(r,{attributes:!0,attributeFilter:["class"]})});})();
